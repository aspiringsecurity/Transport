# okAlice Toyota Hachkathon Backend

## Build

To build the backend [Ink! contracts](https://use.ink/)  you need a working [Rust](https://www.rust-lang.org/) compiler with [cargo-contract](https://github.com/paritytech/cargo-contract) installed:


    $ cd contracts
    $ sh build-all.sh


## Deploy 

To deploy the contract you will need a local node running, the code was tested on [Swanky node](https://github.com/AstarNetwork/swanky-node/releases/).

The **deploy.py** script will deploy the compiled contracts:

    $ python3 contratcs/deploy.py
    ‚úÖ Deployed assignment/assignment as Assigment for Hash : 5GjhGhEYLkuJFZTwdTMFZ4GpYhHSvyVDFZ3sXkTnPnmvMrHP CodeHash: 0x9916bd157b9ae219e08ad0a63e1e668903f7639fadf67b4c187493e4b113a29b
    ‚úÖ Deployed employee/employee as Employee for Hash : 5Dhgwd2agw49LUUkwmEasyGY5kQd3BEYwWzN1cBWgZyzoAWR CodeHash: 0xdfe4b0e185d389c134d4d908278189517a328417478f8f9905f896fdbee5813d
    ‚úÖ Deployed project as Project : 5HkocnDLcDRPTybQ2HXuA7cKQh6XihUzvaZCfXW6Rinb2BY1 CodeHash: 0x4ed51248db5265f4a53f5b00b455c2e0d765dbab2d1b8e2261b36f31c37c3602

For some unknown reason, the *project* contract is non-functional when deploying through this python script. It has to be deployed manually through the polkadot UI.  Use the contract hashes from the deploy script as argument for the constructor of project
![image](https://user-images.githubusercontent.com/18469570/225447629-b6e046b9-aa8a-417a-902b-cd19f58960a5.png)




Once the *project* contract was succesfully deployed, the **prepenv.py** script can be used to setup the basic environment. This script will setup a testing environment where a new project is created and all 6 dev account are made member.

The script takes 2 arguments: 
* The address of the manually deployed *project* contract
* path to json output (will contain all contract addresses and minted NFT Ids)

For example:

    $ python3 prepenv.py 5HLsbyoZ77HMwCoCMDUFEBdgvQ8T9u2qSRoxNbJa4CnWu3gL /tmp/output.json
    Alice signs:  <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)>
    ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5HLsbyoZ77HMwCoCMDUFEBdgvQ8T9u2qSRoxNbJa4CnWu3gL for 100000000000000000
    ‚úÖ Loaded project from 5HLsbyoZ77HMwCoCMDUFEBdgvQ8T9u2qSRoxNbJa4CnWu3gL  CodeHash: 0x4ed51248db5265f4a53f5b00b455c2e0d765dbab2d1b8e2261b36f31c37c3602
    ‚úÖ Loaded employee/employee from 5GjwnvVFm2HsAuAWTwVh81MzqqqBWKWkjxHKQJUMTqZ9Wqz7  CodeHash: 0xdfe4b0e185d389c134d4d908278189517a328417478f8f9905f896fdbee5813d
    ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5GjwnvVFm2HsAuAWTwVh81MzqqqBWKWkjxHKQJUMTqZ9Wqz7 for 100000000000000000
    ‚úÖ Loaded assignment/assignment from 5EqSN8RNariZBg83NdGSn5LM7FHdKbwLYKeg8Zq9qBny6cPC  CodeHash: 0x9916bd157b9ae219e08ad0a63e1e668903f7639fadf67b4c187493e4b113a29b
    ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5EqSN8RNariZBg83NdGSn5LM7FHdKbwLYKeg8Zq9qBny6cPC for 100000000000000000
      üòé Call Create Project create_project : Events
    ‚úÖ Loaded assignment/assignment from 5FLqbDEvRhAR7q7hnmgTWB36THUb8uWKg7ttUrp85Jq1x94p  CodeHash: 0x9916bd157b9ae219e08ad0a63e1e668903f7639fadf67b4c187493e4b113a29b
    ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5FLqbDEvRhAR7q7hnmgTWB36THUb8uWKg7ttUrp85Jq1x94p for 100000000000000000
      üòé Call Mint Employee for alice Minting::mint : Events {Transfer : from:None to:5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY id:{'U64': 1} }
      üòé Call Employee metadata alice Minting::assign_metadata : Events


For further testing the **compenv.py** script can be used. This script takes the json file generated by **prepenv.py** as single argument:

     python3 compenv.py /tmp/w.json
    Alice signs:  <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)>
    üçâüçâüçâ Loading contracts üçâüçâüçâ
      ‚úÖ Loaded project from 5Ec8UDLURsaKGZozPJeb2uTd8Jp6dMFXLcsfsELrvSRdWMv4  CodeHash: 0xbbc85b587864a5f81fcabe6c6d12af523e6d445dc7501f9673b6621c739397cc
      ‚úÖ Loaded employee/employee from 5CiFXSXJSSdhinPd1gmDjfU9ZwvHGLrUB4atMq6bqxj3Vija  CodeHash: 0xd3d472b5bed123aca867e7bb4d3bbf63a883de1ec6075f3a49ec059b390894c9
      ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5CiFXSXJSSdhinPd1gmDjfU9ZwvHGLrUB4atMq6bqxj3Vija for 100000000000000000
    üçâüçâüçâ Create project üçâüçâüçâ
       üòé Call Create Project create_project: Events {ProjectCreated : creator:5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY project_id:1292957714 employee_project:5Gs5Vb3pCEqGExovGbPi8yC597XGQ4erUErawCCHFqSDqk4Y }  
      ‚úÖ Loaded assignment/assignment from 5Gs5Vb3pCEqGExovGbPi8yC597XGQ4erUErawCCHFqSDqk4Y  CodeHash: 0x9b1ee5c445ec7bdcac070594ef15da194816b399bcf03b912e8ff5cc3d3130df
      ‚úÖ Successful transfer from <Keypair (address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)> to 5Gs5Vb3pCEqGExovGbPi8yC597XGQ4erUErawCCHFqSDqk4Y for 100000000000000000
    üçâüçâüçâ Add project members üçâüçâüçâ
       üòé Call Mint Employee-Project for alice Minting::mint : Events {Transfer : from:None to:5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY id:{'U64': 1} }  
       üòé Call Employee_project metadata alice Minting::assign_metadata
       üòé Call Employee_project voting_power alice set_caller_project_voting_power
       üòé Call Mint Employee-Project for bob Minting::mint : Events {Transfer : from:None to:5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty id:{'U64': 2} }  
       üòé Call Employee_project metadata bob Minting::assign_metadata
       üòé Call Employee_project voting_power bob set_caller_project_voting_power
       
       
Good luck!

